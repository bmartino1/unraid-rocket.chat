# ðŸš€ unraid-rocket.chat

**Turn-key Rocket.Chat stack for Unraid** â€” one `git clone`, one `setup.sh`, one `docker compose up -d`.

This project replaces the AIO (all-in-one) Docker approach with a proper multi-container stack using **official upstream images**. That means Rocket.Chat, MongoDB, and NATS all receive their own security updates directly from their maintainers.

---

## What's in the stack

| Service | Image | Purpose |
|---|---|---|
| **MongoDB 8** | `mongodb/mongodb-community-server:8.2-ubi8` | Database with automatic replica-set init |
| **NATS** | `nats:2.11-alpine` | Microservices message transport |
| **Rocket.Chat** | `registry.rocket.chat/rocketchat/rocket.chat:latest` | Chat application (text, voice, video) |
| **Nginx** | `nginx:stable-alpine` | Reverse proxy (HTTP 60080 / HTTPS 60443) |

All services run on a dedicated `rocketchat_net` bridge network.

---

## Quick Start

### Prerequisites

- Unraid 6.12+ with Docker enabled
- Docker Compose plugin (ships with Unraid) or standalone `docker-compose`
- `openssl` (pre-installed on Unraid)

### Install

```bash
# Clone into Unraid appdata
git clone https://github.com/bmartino1/unraid-rocket.chat.git \
    /mnt/user/appdata/unraid-rocket.chat

cd /mnt/user/appdata/unraid-rocket.chat

# Edit .env â€” at minimum, set your Unraid IP
nano .env

# Run setup (creates dirs, generates self-signed TLS cert, writes Nginx config)
bash setup.sh

# Start everything
docker compose up -d
```

### Access

| Method | URL |
|---|---|
| HTTPS (recommended) | `https://<YOUR_IP>:60443` |
| HTTP (redirects to HTTPS) | `http://<YOUR_IP>:60080` |
| Direct (no proxy) | `http://<YOUR_IP>:3000` |

The first-run wizard will walk you through creating the admin account.

---

## Configuration (.env)

All settings are in the `.env` file. Key values to change:

| Variable | Default | Description |
|---|---|---|
| `ROOT_URL` | `http://192.168.2.42:60080` | How users reach Rocket.Chat externally |
| `NGINX_HOST` | `192.168.2.42` | IP/domain for the TLS certificate |
| `NGINX_HTTP_PORT` | `60080` | HTTP port (Unraid uses 80) |
| `NGINX_HTTPS_PORT` | `60443` | HTTPS port (Unraid uses 443) |
| `RC_HOST_PORT` | `3000` | Direct access port (set empty to disable) |
| `RC_RELEASE` | `latest` | Rocket.Chat version tag |
| `MONGODB_VERSION` | `8.2-ubi8` | MongoDB version |
| `DATA_DIR` | `/mnt/user/appdata/unraid-rocket.chat` | Persistent data root |
| `REG_TOKEN` | *(empty)* | Optional cloud.rocket.chat registration token |

---

## Directory Layout

```
/mnt/user/appdata/unraid-rocket.chat/
â”œâ”€â”€ compose.yml              # Docker Compose stack definition
â”œâ”€â”€ .env                     # Environment configuration
â”œâ”€â”€ setup.sh                 # One-time setup script
â”œâ”€â”€ nginx/
â”‚   â”œâ”€â”€ default.conf.template   # Nginx config template (in git)
â”‚   â”œâ”€â”€ default.conf            # Generated Nginx config (gitignored)
â”‚   â””â”€â”€ certs/
â”‚       â”œâ”€â”€ rocketchat.crt      # TLS certificate (generated by setup.sh)
â”‚       â””â”€â”€ rocketchat.key      # TLS private key (generated by setup.sh)
â”œâ”€â”€ mongodb/                 # MongoDB data (gitignored)
â””â”€â”€ uploads/                 # Rocket.Chat file uploads (gitignored)
```

---

## Useful Commands

```bash
cd /mnt/user/appdata/unraid-rocket.chat

# Tail all logs
docker compose logs -f

# Tail Rocket.Chat only
docker compose logs -f rocketchat

# Check service health
docker compose ps

# Stop everything
docker compose down

# Update to latest images
docker compose pull
docker compose up -d

# Restart Nginx after cert change
docker compose restart nginx

# MongoDB shell access
docker compose exec mongodb mongosh
```

---

## Using Real TLS Certificates

The setup script generates a self-signed certificate. To replace it:

```bash
# Copy your certificate and key
cp /path/to/your-cert.pem /mnt/user/appdata/unraid-rocket.chat/nginx/certs/rocketchat.crt
cp /path/to/your-key.pem  /mnt/user/appdata/unraid-rocket.chat/nginx/certs/rocketchat.key

# Restart Nginx
docker compose restart nginx
```

Update `ROOT_URL` in `.env` to use `https://your-domain:60443` and restart Rocket.Chat:

```bash
docker compose up -d rocketchat
```

---

## Why Not AIO?

The AIO (all-in-one) image bundled MongoDB, NATS, Postfix, and Rocket.Chat into a single container. While convenient, it had significant drawbacks:

- **Update friction** â€” MongoDB and Rocket.Chat update on different cycles. A single image meant rebuilding everything for any update.
- **MongoDB replica set issues** â€” Running mongod inside the app container led to PID management problems and unreliable replica-set initialization on Unraid.
- **Debugging difficulty** â€” All logs mixed together, health checks couldn't target individual services.
- **Upstream drift** â€” Rocket.Chat's own compose structure changed significantly (new NATS requirement, MongoDB 8 support, deprecated old compose files), making the AIO increasingly brittle.

The multi-container approach lets each service use its official image, get independent updates, and fail/restart independently.

---

## Troubleshooting

**MongoDB won't start / replica set errors**
```bash
docker compose logs mongodb | tail -30
```
If the data directory has stale lock files from a previous AIO:
```bash
docker compose down
rm -f /mnt/user/appdata/unraid-rocket.chat/mongodb/mongod.lock
rm -f /mnt/user/appdata/unraid-rocket.chat/mongodb/WiredTiger.lock
docker compose up -d
```

**Rocket.Chat exits with "oplog" errors**
This means MongoDB isn't running as a replica set. The compose entrypoint handles this automatically, but if you migrated from a standalone MongoDB, the data may need re-initialization:
```bash
docker compose down
# WARNING: This deletes your database. Back up first if you have data.
rm -rf /mnt/user/appdata/unraid-rocket.chat/mongodb/*
docker compose up -d
```

**Port conflicts**
If another service uses 60080/60443, change `NGINX_HTTP_PORT` and `NGINX_HTTPS_PORT` in `.env`, re-run `bash setup.sh`, and restart.

---

## Credits

- [Rocket.Chat](https://github.com/RocketChat/Rocket.Chat) â€” the application
- [RocketChat/rocketchat-compose](https://github.com/RocketChat/rocketchat-compose) â€” official multi-file compose reference
- [bmartino1/rocket.chat](https://github.com/bmartino1/rocket.chat) â€” AIO image and Unraid community support
- [Unraid forums](https://forums.unraid.net/topic/61337-support-rocketchat/) â€” community troubleshooting

---

## License

MIT
